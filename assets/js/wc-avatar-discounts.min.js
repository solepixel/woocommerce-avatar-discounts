var WoocommerceAvatarDiscounts;(WoocommerceAvatarDiscounts=window.WoocommerceAvatarDiscounts||{}).Manage=function(n){"use strict";function t(){n(c).removeClass("expanded")}var c=".wc-ad-manage-avatars",a=function(){n(c+" a").off("click").on("click",function(a){a.preventDefault();var t=n(this).attr("data-avatar-id");if(!o())return n(this).blur(),void r();i(t)})},e=function(){n(c+" a .delete-avatar").off("click").on("click",function(a){if(a.preventDefault(),a.stopPropagation(),!confirm("Are you sure you want to delete this Avatar?"))return!1;WoocommerceAvatarDiscounts.Upload.showLoader();var t=n(this).parents("a"),e=t.attr("data-avatar-id"),o=n('input[name="woocommerce_avatar_discounts_user"]').val();if(e==n('input[name="woocommerce_avatar_discounts_avatar"]').val()){var r=n(c+' a:not([data-avatar-id="'+e+'"])').first();r.length&&i(r.attr("data-avatar-id"))}n.ajax({url:wcad_vars.ajax_url,type:"post",data:{action:"wcad_delete_avatar",avatar:e,user:o},success:function(a){a.success?t.fadeOut("fast",function(){t.remove(),s()}):alert(a.error),WoocommerceAvatarDiscounts.Upload.hideLoader()}})})},s=function(){var a=n("b.badge-count"),t=n(".wc-ad-avatar-selection > a").length;a.html(t).attr("title",t+" Avatars to choose from")},o=function(){return!!n("body").hasClass("wp-admin")||n(c).hasClass("expanded")},r=function(){n(c).addClass("expanded")},i=function(a){n('input[name="woocommerce_avatar_discounts_avatar"]').val(a),d(),n(c+' a[data-avatar-id="'+a+'"]').addClass("status-featured").blur(),t()},d=function(){n(c+" a.status-featured").removeClass("status-featured")};return{init:function(){a(),e()},clearFeatured:d,collapseAvatars:t,updateCount:s}}(jQuery),jQuery(window).on("load",WoocommerceAvatarDiscounts.Manage.init),(WoocommerceAvatarDiscounts=window.WoocommerceAvatarDiscounts||{}).Upload=function(n){"use strict";var a=function(){n(".wc-ad-upload").on("change",function(){var t=n(this);n(".wc-ad-file-display").html(function(a){if(a){var t=0<=a.indexOf("\\")?a.lastIndexOf("\\"):a.lastIndexOf("/"),e=a.substring(t);return 0!==e.indexOf("\\")&&0!==e.indexOf("/")||(e=e.substring(1)),e}}(t.val()));var a=t.attr("name"),e=t.prop("files")[0],o=new FormData,r=n('input[name="woocommerce_avatar_discounts_user"]').val();e&&(o.append(a,e),o.append("user",r),c(),n.ajax({url:wcad_vars.ajax_url+"?action=wcad_upload_avatar",dataType:"text",cache:!1,contentType:!1,processData:!1,type:"post",data:o,success:function(a){a=JSON.parse(a),n(".wc-ad-file-display").html(""),t.val(),a.success?(WoocommerceAvatarDiscounts.Manage.clearFeatured(),n(".wc-ad-avatar-selection").append(a.html),WoocommerceAvatarDiscounts.Manage.init(),WoocommerceAvatarDiscounts.Manage.updateCount(),WoocommerceAvatarDiscounts.Manage.collapseAvatars()):alert(a.error),s()}}))})},c=function(){var a=n(".wcad-loader");if(!a.length){a=n("<div />").addClass("wcad-loader");var t=n("<span />").addClass("spinner");a.append(t),n(".wc-ad-manage-avatars").prepend(a)}a.addClass("active")},s=function(){n(".wcad-loader").removeClass("active")};return{init:function(){a()},showLoader:c,hideLoader:s}}(jQuery),jQuery(window).on("load",WoocommerceAvatarDiscounts.Upload.init);